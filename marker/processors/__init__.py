# Модуль базовых классов для всех processors
# Содержит BaseProcessor - базовый класс для всех процессоров системы Marker

from typing import Optional, Tuple

from pydantic import BaseModel

from marker.schema import BlockTypes
from marker.schema.document import Document
from marker.util import assign_config


class BaseProcessor:
    """
    Базовый класс для всех процессоров системы Marker.
    
    Processors отвечают за обработку и улучшение блоков документа после
    их создания builders. Они выполняют различные задачи: объединение строк,
    обработку таблиц, математических формул, списков и других элементов.
    
    BaseProcessor предоставляет:
    - Автоматическую настройку конфигурации через assign_config
    - Определение типов блоков, за которые отвечает процессор
    - Единый интерфейс обработки через __call__
    - Контракт для обязательной реализации в наследниках
    
    Атрибуты:
        block_types: Кортеж типов блоков, за которые отвечает данный процессор.
                    Если None, процессор может обрабатывать любые блоки.
    """
    # Типы блоков, за которые отвечает данный процессор
    # Если None, процессор может обрабатывать любые блоки
    block_types: Tuple[BlockTypes] | None = None

    def __init__(self, config: Optional[BaseModel | dict] = None):
        """
        Инициализирует процессор с опциональной конфигурацией.
        
        Автоматически применяет переданную конфигурацию к атрибутам класса
        с помощью функции assign_config, которая поддерживает различные
        форматы конфигурации.
        
        Аргументы:
            config: Конфигурация в виде модели Pydantic или словаря Python.
                   Если None, используется конфигурация по умолчанию.
        """
        # Назначаем конфигурацию атрибутам класса
        assign_config(self, config)

    def __call__(self, document: Document, *args, **kwargs):
        """
        Основной метод для обработки документа.
        
        Этот метод должен быть реализован в каждом конкретном процессоре.
        Он принимает документ и выполняет специфическую обработку блоков
        в соответствии с назначением процессора.
        
        Аргументы:
            document: Документ для обработки
            *args: Дополнительные позиционные аргументы
            **kwargs: Дополнительные именованные аргументы
        
        Возвращает:
            Результат обработки (зависит от типа процессора)
        
        Исключения:
            NotImplementedError: Если метод не реализован в наследнике
        """
        raise NotImplementedError("Метод __call__ должен быть реализован в наследнике BaseProcessor")