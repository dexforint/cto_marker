# Модуль базовых классов для всех builders
# Содержит BaseBuilder - базовый класс для всех builder компонентов системы Marker

from typing import Optional

from pydantic import BaseModel

from marker.util import assign_config


class BaseBuilder:
    """
    Базовый класс для всех builder компонентов системы Marker.
    
    Builders отвечают за создание и структурирование различных частей документа
    на основе исходных данных. Все конкретные builders наследуются от этого класса
    и реализуют свою специфическую логику построения.
    
    BaseBuilder предоставляет:
    - Автоматическую настройку конфигурации через assign_config
    - Единый интерфейс вызова через __call__
    - Контракт для обязательной реализации в наследниках
    """
    
    def __init__(self, config: Optional[BaseModel | dict] = None):
        """
        Инициализирует builder с опциональной конфигурацией.
        
        Автоматически применяет переданную конфигурацию к атрибутам класса
        с помощью функции assign_config, которая поддерживает различные
        форматы конфигурации.
        
        Аргументы:
            config: Конфигурация в виде модели Pydantic или словаря Python.
                   Если None, используется конфигурация по умолчанию.
        """
        # Назначаем конфигурацию атрибутам класса
        assign_config(self, config)

    def __call__(self, data, *args, **kwargs):
        """
        Основной метод для выполнения построения документа.
        
        Этот метод должен быть реализован в каждом конкретном builder классе.
        Он принимает входные данные и возвращает структурированный результат
        в соответствии с назначением конкретного builder.
        
        Аргументы:
            data: Входные данные для построения (зависит от типа builder)
            *args: Дополнительные позиционные аргументы
            **kwargs: Дополнительные именованные аргументы
        
        Возвращает:
            Результат построения (зависит от типа builder)
        
        Исключения:
            NotImplementedError: Если метод не реализован в наследнике
        """
        raise NotImplementedError("Метод __call__ должен быть реализован в наследнике BaseBuilder")